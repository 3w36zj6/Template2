[%  # book/index: determine index page information for a book and build the 
    # POD and HTML index pages
    
    IF (xindex = xbook.getElementsByTagName('index', 0));
	# use details specified in an <index> element
	podfile  = xindex.podfile;
	podname  = xindex.pod
		or podfile.replace('\/', '::').replace('\.pod$', '');
	htmlfile = xindex.html
	        or ( book.html ? "$book.html/index.html" : "index.html" );
	page = {
	    id      => 'index',
	    podname => podname,
	    podfile => podfile,
	    about   => book.about,
	    intro   => book.intro,
	    html    => htmlfile,
	    title   => xindex.title or book.title,
	    standalone => 1,
	};
        book.index = page;
#	"added book index page for: $page.podname => $page.html\n" | stderr;

	# build the Pod index page
	"   * INDEX  pod: [ $dir.pod/$podfile ]\n" | stderr UNLESS quiet;
	content = INCLUDE pod/index;
	content = INCLUDE pod/page;
	content | redirect("$dir.pod/$podfile");

        index = page;
    ELSE;
	# otherwise use 'index.html' for HTML index
	page = {
	    id    = 'index',
	    about = book.about,
	    intro = book.intro,
	    html  = "$book.html/index.html",
	    title = book.title,
	};

	IF book.pages.size == 1;
	    book.index = book.pages.0;
#	    "only 1 page ($book.index.podname => $book.index.html)\n" | stderr;
	ELSE;
	    book.index = page;
	END;
    END;

    # build the HTML index page
    "   * INDEX html: [ $dir.html.src/$page.html ]\n" | stderr UNLESS quiet;
    PROCESS html/index | redirect("$dir.html.src/$page.html");
-%]

