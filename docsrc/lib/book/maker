[%  # ARGS: xbook - an XML DOM node to a book element
    #       xcontent(xnode, name) - MACRO to fetch name element from node

    # setup data
    id   = xbook.id;
    name = xbook.name or id;
    type = xbook.type or 'pod,html'
    html = xbook.html or id;

    book = {
        id     = id
        name   = name
	src    = xbook.src or id
	type   = xbook.type or 'pod'
	html   = html
	title  = xbook.title or name
	prefix = xbook.prefix
	about  = xbook.about or xcontent(xbook, 'about')
	intro  = xcontent(xbook, 'intro')
	uplink = html.replace('[^/]+', '..')
	pages  = [ ]
    };

    IF debug;
	RETURN UNLESS book.id == 'Modules';
    END;

    # status info
    PROCESS book/info | stderr UNLESS quiet;

    # process book pages
    FOREACH xpage = xbook.getElementsByTagName('page');
	PROCESS page/maker;
        book.pages.push(page);
    END;

    # look for index entry
    PROCESS book/index;
-%]


